<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒ€ ì¡°í•©ê¸° (ì£¼ìµœììš©)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <style>
        /* --- ê¸°ë³¸ --- */
        html {
            overflow-y: scroll;
            background-color: #2c2c2c;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #2c2c2c; 
            color: #f0f0f0;
            margin: 0;
            padding: 20px; 
        }

        /* h1 ìŠ¤íƒ€ì¼ */
        h1 {
            border-bottom: 2px solid #555; padding-bottom: 8px; color: #e0e0e0;
            margin-top: 0; margin-bottom: 15px;
        }
        h1, h2, h3 { color: #e0e0e0; }
        #right-column h2, .column-header {
            border-bottom: 2px solid #555; padding-bottom: 8px;
        }
        h2 { margin-top: 0; }
        hr { display: none; }

        /* --- 2ë‹¨ ë ˆì´ì•„ì›ƒ --- */
        .main-container {
            display: flex; gap: 20px; justify-content: center; 
            max-width: 1440px; width: 100%; margin: 0 auto; 
        }
        .column {
            background-color: #1e1e1e; padding: 20px; border-radius: 8px;
            border: 1px solid #444;
        }
        #left-column {
            flex-basis: 60% !important; flex-grow: 0 !important; flex-shrink: 0 !important;
            max-width: 800px; position: sticky; top: 20px; align-self: flex-start; 
        }
        #right-column {
            flex-basis: 40% !important; flex-grow: 0 !important; flex-shrink: 0 !important;
            max-width: 600px; 
        }

        /* --- ì™¼ìª½ ì»¬ëŸ¼ í—¤ë” --- */
        .column-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; flex-shrink: 0; 
        }
        .column-header h2 { margin-bottom: 0; }
        .team-controls { display: flex; gap: 10px; flex-shrink: 0; flex-wrap: wrap; /* ë²„íŠ¼ ë§ì•„ì§€ë©´ ì¤„ë°”ê¿ˆ */ }
        .team-controls button {
            border: none; padding: 8px 12px; font-size: 0.9em;
            border-radius: 5px; cursor: pointer; font-weight: bold;
        }
        #add-team-button { background-color: #2ecc71; color: white; }
        #add-team-button:hover { background-color: #27ae60; }
        #reset-all-button { background-color: #e74c3c; color: white; }
        #reset-all-button:hover { background-color: #c0392b; }
        #save-image-button { background-color: #9b59b6; color: white; }
        #save-image-button:hover { background-color: #8e44ad; }
        /* [ì‹ ê·œ] í…ìŠ¤íŠ¸ ë³µì‚¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #copy-teams-button { background-color: #f39c12; color: white; }
        #copy-teams-button:hover { background-color: #e67e22; }
        /* [ì‹ ê·œ] ë³µì‚¬ ì™„ë£Œ ì‹œ ìŠ¤íƒ€ì¼ (ì„ì‹œ) */
        #copy-teams-button.copied { background-color: #27ae60; }


        /* --- ëª¨ë“  íŒ€ ì»¨í…Œì´ë„ˆ (ì™¼ìª½ ì—´) --- */
        #all-teams-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }

        /* --- ê°œë³„ íŒ€ ë°•ìŠ¤ --- */
        .team-box {
            background-color: #222; border: 3px solid #555; border-radius: 8px;
            padding: 15px; transition: border-color 0.2s, box-shadow 0.2s;
            cursor: pointer; position: relative; padding-bottom: 45px; 
        }
        .team-box.active { border-color: #61dafb; box-shadow: 0 0 10px #61dafb80; }
        .team-box h3 {
            margin-top: 0; border: none; padding-bottom: 10px;
            border-bottom: 1px dashed #777; font-size: 1.3em;
        }
        .team-member-list {
            min-height: 30px; display: flex; flex-wrap: wrap;
            gap: 6px; padding: 5px 0;
        }
        .team-member {
            background-color: #61dafb; color: #222; padding: 5px 10px;
            border-radius: 4px; font-weight: bold; font-size: 0.9em;
            cursor: pointer; transition: background-color 0.2s, color 0.2s; 
        }
        .team-member:hover { background-color: #e74c3c; color: white; }
        .team-box-buttons { position: absolute; bottom: 10px; right: 15px; display: flex; gap: 5px; }
        .clear-team-button, .remove-team-button {
            background-color: #95a5a6; color: #222; border: none;
            padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em;
        }
        .clear-team-button:hover { background-color: #7f8c8d; }
        .remove-team-button { background-color: #e74c3c; color: white; }
        .remove-team-button:hover { background-color: #c0392b; }


        /* --- ìƒˆ ì„ ìˆ˜ ì¶”ê°€ í¼ --- */
        .add-player-form {
            background-color: #202020; border: 1px solid #444; border-radius: 8px; 
            padding: 15px; margin-bottom: 15px; display: flex; gap: 10px; 
            align-items: center; flex-shrink: 0; 
        }
        .add-player-form input[type="text"],
        .add-player-form select {
            background-color: #333; color: white; border: 1px solid #555;
            border-radius: 4px; padding: 8px 10px; font-size: 0.95em; flex-shrink: 0; 
        }
        .add-player-form input[type="text"] { flex: 1 1 180px; }
        .add-player-form button {
            background-color: #2ecc71; color: white; border: none;
            padding: 8px 15px; border-radius: 4px; cursor: pointer;
            font-weight: bold; flex-shrink: 0; 
        }
        .add-player-form button:hover { background-color: #27ae60; }

        /* --- ì„ ìˆ˜ ëª©ë¡ (ì˜¤ë¥¸ìª½ ì—´) --- */
        #player-list { display: flex; flex-direction: column; gap: 15px; }
        .tier-group {
            background-color: #202020; border: 1px solid #444; border-radius: 8px; 
            padding: 10px 15px; transition: background-color 0.2s; flex-shrink: 0; 
        }
        .player-button-group { display: flex; flex-wrap: wrap; gap: 8px; min-height: 30px; }
        .player-button-group.drag-over { background-color: #333; border: 1px dashed #61dafb; }
        .player-button {
            position: relative; background-color: #444; color: white;
            border: 2px solid #666; padding: 8px 12px; padding-right: 25px; 
            border-radius: 5px; cursor: pointer; font-size: 0.95em;
            font-weight: 500; transition: background-color 0.2s, border-color 0.2s, opacity 0.2s;
        }
        .player-button:hover:not(:disabled) { background-color: #555; border-color: #888; }
        .player-button.dragging { opacity: 0.4; border: 2px dashed white; }
        .delete-player-btn {
            position: absolute; top: -1px; right: 0; width: 20px; height: 100%; 
            line-height: 28px; text-align: center; color: #aaa; font-size: 1.2em; 
            font-weight: bold; border-radius: 0 4px 4px 0; 
            transition: background-color 0.2s, color 0.2s;
        }
        .delete-player-btn:hover { background-color: #e74c3c; color: white; }
        .tier-SSR { border-color: #ffd700; } .tier-SR { border-color: #e74c3c; }
        .tier-S  { border-color: #3498db; } .tier-A  { border-color: #9b59b6; }
        .tier-B  { border-color: #2ecc71; }
        .player-button.selected {
            background-color: #e74c3c; border-color: #e74c3c; color: white;
            opacity: 0.5; cursor: not-allowed; text-decoration: line-through;
        }
        .player-button.disabled {
            background-color: #3a3a3a; border-color: #3a3a3a; color: #777;
            opacity: 0.6; cursor: not-allowed;
        }
        .player-button.selected .delete-player-btn,
        .player-button.disabled .delete-player-btn { display: none; }
    </style>
</head>
<body>
    <h1>íŒ€ ì¡°í•© ì±Œë¦°ì§€ (ì£¼ìµœììš©)</h1>
    
    <div class="main-container">

        <div id="left-column" class="column">
            
            <div class="column-header">
                <h2>íŒ€ í˜„í™©</h2>
                <div class="team-controls">
                    <button id="copy-teams-button">ğŸ“‹ í…ìŠ¤íŠ¸ ë³µì‚¬</button>
                    <button id="save-image-button">ğŸ–¼ï¸ ì´ë¯¸ì§€ ì €ì¥</button> 
                    <button id="add-team-button">â• ìƒˆ íŒ€ ì¶”ê°€</button>
                    <button id="reset-all-button">ğŸš¨ ëª¨ë“  íŒ€ ì´ˆê¸°í™”</button>
                </div>
            </div>

            <div id="all-teams-container">
                </div>
        </div>

        <div id="right-column" class="column">
            <h2>ì„ ìˆ˜ ëª©ë¡</h2>

            <div class="add-player-form">
                <input type="text" id="new-player-name" placeholder="ì„ ìˆ˜ ì´ë¦„">
                <select id="new-player-cost">
                    <option value="8">8 ì½”ìŠ¤íŠ¸ (SSR)</option>
                    <option value="7">7 ì½”ìŠ¤íŠ¸ (SR)</option>
                    <option value="6">6 ì½”ìŠ¤íŠ¸ (S)</option>
                    <option value="5">5 ì½”ìŠ¤íŠ¸ (A)</option>
                    <option value="4">4 ì½”ìŠ¤íŠ¸ (B)</option>
                    <option value="3">3 ì½”ìŠ¤íŠ¸ (C)</option>
                    <option value="2">2 ì½”ìŠ¤íŠ¸ (D)</option>
                    <option value="1">1 ì½”ìŠ¤íŠ¸ (E)</option>
                </select>
                <button id="add-player-button">ì„ ìˆ˜ ì¶”ê°€</button>
            </div>

            <div id="player-list"> 
                <div class="tier-group">
                    <h3>SSR (8 ì½”ìŠ¤íŠ¸)</h3>
                    <div id="list-SSR" class="player-button-group" data-cost="8" data-tier="SSR"></div>
                </div>
                <div class="tier-group">
                    <h3>SR (7 ì½”ìŠ¤íŠ¸)</h3>
                    <div id="list-SR" class="player-button-group" data-cost="7" data-tier="SR"></div>
                </div>
                <div class="tier-group">
                    <h3>S (6 ì½”ìŠ¤íŠ¸)</h3>
                    <div id="list-S" class="player-button-group" data-cost="6" data-tier="S"></div>
                </div>
                <div class="tier-group">
                    <h3>A (5 ì½”ìŠ¤íŠ¸)</h3>
                    <div id="list-A" class="player-button-group" data-cost="5" data-tier="A"></div>
                </div>
                <div class="tier-group">
                    <h3>B (4 ì½”ìŠ¤íŠ¸)</h3>
                    <div id="list-B" class="player-button-group" data-cost="4" data-tier="B"></div>
                </div>
                <div class="tier-group">
                    <h3>C (3 ì½”ìŠ¤íŠ¸)</h3>
                    <div id="list-C" class="player-button-group" data-cost="3" data-tier="C"></div>
                </div>
                <div class="tier-group">
                    <h3>D (2 ì½”ìŠ¤íŠ¸)</h3>
                    <div id="list-D" class="player-button-group" data-cost="2" data-tier="D"></div>
                </div>
                <div class="tier-group">
                    <h3>E (1 ì½”ìŠ¤íŠ¸)</h3>
                    <div id="list-E" class="player-button-group" data-cost="1" data-tier="E"></div>
                </div>
            </div>
        </div>

    </div> <script>
        // ì‚¬ìš©ìë‹˜ì´ ì£¼ì‹  JavaScript ì½”ë“œ (4íŒ€ / 15ì½”ìŠ¤íŠ¸ / íŒ€3ëª…ì œí•œ / ìë™ë°°ì •X)
        const defaultPlayers = [
            { name: 'í”¼ë‹‰ìŠ¤ë°•', cost: 8, tier: 'SSR' },
            { name: 'ë¯¼ì‹ë°•', cost: 7, tier: 'SR' }, { name: 'ê°±ë§˜', cost: 7, tier: 'SR' },
            { name: 'ì´ë¡œ', cost: 7, tier: 'SR' }, { name: 'ê²€ë©‹', cost: 7, tier: 'SR' },
            { name: 'í–‰ìˆ˜', cost: 7, tier: 'SR' }, { name: 'ì´ë¹„ìŠ¤', cost: 6, tier: 'S' },
            { name: 'ìì—°', cost: 6, tier: 'S' }, { name: 'í™©ë¸”ë¦°', cost: 6, tier: 'S' },
            { name: 'ëª¨ì¹´í˜•', cost: 6, tier: 'S' }, { name: 'í”¼ì•„ë…¸ìº£', cost: 6, tier: 'S' },
            { name: 'í›„ì°¸', cost: 5, tier: 'A' }, { name: 'ë°©ì°Œ', cost: 5, tier: 'A' },
            { name: 'ìœ ì„¸ë¼', cost: 5, tier: 'A' }, { name: 'ì•°ë¹„ì…˜', cost: 5, tier: 'A' },
            { name: 'ê¹€ë¿¡', cost: 5, tier: 'A' }, { name: 'í›„ë‹ˆ', cost: 5, tier: 'A' },
            { name: 'ë†ë£¨íŠ¸', cost: 4, tier: 'B' }, { name: 'ì­ì­', cost: 4, tier: 'B' },
            { name: 'ê°ê·œë¦¬', cost: 4, tier: 'B' }, { name: 'ìœ í† ë§', cost: 4, tier: 'B' },
            { name: 'ì²œì‹œì•„', cost: 4, tier: 'B' }, { name: 'ì°¬ìš°ì •', cost: 4, tier: 'B' },
            { name: 'ì™ˆë„ì¿¤', cost: 3, tier: 'C' }, { name: 'ë°©ìº', cost: 3, tier: 'C' },
            { name: 'ì¾…ì¤€', cost: 3, tier: 'C' }, { name: 'í—¤ì§•', cost: 3, tier: 'C' },
            { name: 'ì‚ë¶€', cost: 3, tier: 'C' }, { name: 'ê³ ì°¨ë¹„', cost: 3, tier: 'C' },
            { name: 'ìº¡í‹´ì­', cost: 3, tier: 'C' }, { name: 'ë‹¤ë¹„', cost: 3, tier: 'C' },
            { name: 'ì´ì„ ', cost: 3, tier: 'C' }, { name: 'ìˆœë‹¹ë¬´', cost: 3, tier: 'C' },
            { name: 'ë¹„í–‰ë¼ì§€', cost: 2, tier: 'D' }, { name: 'ë©‹ì‚¬', cost: 2, tier: 'D' },
            { name: 'ëª¨ì‰', cost: 2, tier: 'D' }, { name: 'ì˜¤ë‰´', cost: 2, tier: 'D' },
            { name: 'ë‘ë­‰', cost: 1, tier: 'E' }, { name: 'í‘¸ë¦°', cost: 1, tier: 'E' },
            { name: 'ì¹˜ì¹´', cost: 1, tier: 'E' }, { name: 'ëƒë¯¸', cost: 1, tier: 'E' },
            { name: 'ìƒ˜ì›¨', cost: 1, tier: 'E' }, { name: 'ë‚˜ë¦¬ë•½', cost: 1, tier: 'E' }
        ];

        const defaultTeams = [ 
            { id: 1, name: 'Team 1', members: [], cost: 0 },
            { id: 2, name: 'Team 2', members: [], cost: 0 },
            { id: 3, name: 'Team 3', members: [], cost: 0 },
            { id: 4, name: 'Team 4', members: [], cost: 0 }
        ];
        let players; 
        let allTeams; 
        let activeTeamId = null;
        const MAX_COST = 15; 
        const MAX_MEMBERS_PER_TEAM = 3; 

        function savePlayers() {
            try { localStorage.setItem('savedPlayers', JSON.stringify(players)); } catch (e) { console.error("Error saving players:", e); }
        }
        function saveTeams() {
             try { localStorage.setItem('savedTeams', JSON.stringify(allTeams)); } catch (e) { console.error("Error saving teams:", e); }
        }
        function loadData() {
            try {
                const savedPlayers = localStorage.getItem('savedPlayers');
                players = savedPlayers ? JSON.parse(savedPlayers) : JSON.parse(JSON.stringify(defaultPlayers));
            } catch (e) {
                console.error("Error loading players, using default:", e);
                players = JSON.parse(JSON.stringify(defaultPlayers));
            }

            try {
                const savedTeams = localStorage.getItem('savedTeams');
                allTeams = savedTeams ? JSON.parse(savedTeams) : JSON.parse(JSON.stringify(defaultTeams));
                if (allTeams.length < defaultTeams.length) {
                    allTeams = JSON.parse(JSON.stringify(defaultTeams));
                }
            } catch (e) {
                 console.error("Error loading teams, using default:", e);
                 allTeams = JSON.parse(JSON.stringify(defaultTeams));
            }
            
            activeTeamId = 1; 
        }

        function getTierFromCost(cost) {
            cost = parseInt(cost);
            switch (cost) {
                case 8: return 'SSR'; case 7: return 'SR'; case 6: return 'S';
                case 5: return 'A';   case 4: return 'B';  case 3: return 'C';
                case 2: return 'D';   case 1: return 'E';  default: return 'N/A';
            }
        }
        function updateTeamCostForPlayer(playerName, newCost, oldCost) {
            allTeams.forEach(team => {
                const member = team.members.find(m => m.name === playerName);
                if (member) {
                    member.cost = newCost;
                    team.cost = team.cost - oldCost + newCost;
                    return; 
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const playerListDiv = document.getElementById('player-list');
            const allTeamsContainer = document.getElementById('all-teams-container');
            const addTeamButton = document.getElementById('add-team-button');
            const resetAllButton = document.getElementById('reset-all-button');
            const newPlayerNameInput = document.getElementById('new-player-name');
            const newPlayerCostSelect = document.getElementById('new-player-cost');
            const addPlayerButton = document.getElementById('add-player-button');
            const saveImageButton = document.getElementById('save-image-button'); 
            const copyTeamsButton = document.getElementById('copy-teams-button'); // [ì‹ ê·œ]
            
            loadData();
            
            addTeamButton.addEventListener('click', () => {
                const teamId = Date.now(); 
                const newTeam = { id: teamId, name: `Team ${allTeams.length + 1}`, members: [], cost: 0 };
                allTeams.push(newTeam);
                activeTeamId = teamId; 
                saveTeams(); 
                renderAll(); 
            });

            resetAllButton.addEventListener('click', () => {
                if (confirm('ëª¨ë“  íŒ€ êµ¬ì„±ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì„ ìˆ˜ ëª©ë¡ì€ ìœ ì§€ë©ë‹ˆë‹¤)')) {
                    allTeams = JSON.parse(JSON.stringify(defaultTeams)); 
                    activeTeamId = 1; 
                    saveTeams(); 
                    renderAll(); 
                }
            });

            addPlayerButton.addEventListener('click', () => {
                const name = newPlayerNameInput.value.trim();
                const cost = parseInt(newPlayerCostSelect.value);
                const tier = getTierFromCost(cost);

                if (name === "") { alert('ì„ ìˆ˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
                if (players.some(p => p.name === name)) { alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì„ ìˆ˜ ì´ë¦„ì…ë‹ˆë‹¤.'); return; }

                const newPlayer = { name, cost, tier };
                players.push(newPlayer);
                players.sort((a, b) => a.name.localeCompare(b.name));
                
                savePlayers(); 
                renderAll(); 
                newPlayerNameInput.value = '';
            });
            
            saveImageButton.addEventListener('click', () => {
                const targetElement = document.getElementById('all-teams-container');
                if (!targetElement) { alert('ì´ë¯¸ì§€ë¥¼ ì €ì¥í•  íŒ€ í˜„í™© ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
                const options = { backgroundColor: '#1e1e1e', useCORS: true };

                html2canvas(targetElement, options).then(canvas => {
                    const imageURL = canvas.toDataURL('image/png');
                    const downloadLink = document.createElement('a');
                    downloadLink.href = imageURL;
                    downloadLink.download = 'íŒ€_êµ¬ì„±.png'; 
                    document.body.appendChild(downloadLink); 
                    downloadLink.click();
                    document.body.removeChild(downloadLink); 
                }).catch(error => {
                    console.error('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                    alert('ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                });
            });

            // --- [ì‹ ê·œ] í…ìŠ¤íŠ¸ ë³µì‚¬ ë²„íŠ¼ ---
            copyTeamsButton.addEventListener('click', () => {
                let teamsText = '';
                allTeams.forEach(team => {
                    teamsText += `${team.name} (ì´ ${team.cost}/${MAX_COST}) [${team.members.length}/${MAX_MEMBERS_PER_TEAM}ëª…]:\n`;
                    if (team.members.length > 0) {
                        teamsText += team.members.map(m => `  - ${m.name} (${m.cost})`).join('\n');
                    } else {
                        teamsText += '  (ì„ ìˆ˜ ì—†ìŒ)';
                    }
                    teamsText += '\n\n'; // íŒ€ ì‚¬ì´ì— ë¹ˆ ì¤„ ì¶”ê°€
                });

                // í´ë¦½ë³´ë“œì— ë³µì‚¬ (Clipboard API ì‚¬ìš©)
                navigator.clipboard.writeText(teamsText.trim())
                    .then(() => {
                        // ë³µì‚¬ ì„±ê³µ ì‹œ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½ (í”¼ë“œë°±)
                        const originalText = copyTeamsButton.textContent;
                        copyTeamsButton.textContent = 'âœ… ë³µì‚¬ ì™„ë£Œ!';
                        copyTeamsButton.classList.add('copied');
                        setTimeout(() => {
                            copyTeamsButton.textContent = originalText;
                            copyTeamsButton.classList.remove('copied');
                        }, 1500); // 1.5ì´ˆ í›„ ì›ë˜ëŒ€ë¡œ ë³µê·€
                    })
                    .catch(err => {
                        console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                        alert('í…ìŠ¤íŠ¸ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    });
            });


            playerListDiv.addEventListener('click', (event) => {
                if (!event.target.classList.contains('player-button')) return;
                if (!activeTeamId) { alert('ë¨¼ì € ì„ ìˆ˜ë¥¼ ì¶”ê°€í•  íŒ€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
                const button = event.target;
                const name = button.dataset.name;
                const cost = parseInt(button.dataset.cost);
                const activeTeam = allTeams.find(team => team.id === activeTeamId);
                if (!activeTeam) return; 

                if (activeTeam.members.length >= MAX_MEMBERS_PER_TEAM) {
                    alert(`íŒ€ ì¸ì›ì€ ìµœëŒ€ ${MAX_MEMBERS_PER_TEAM}ëª…ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.`);
                    return;
                }

                const isPlayerTaken = allTeams.some(team => 
                    team.members.some(member => member.name === name)
                );
                if (isPlayerTaken) { alert('ì´ë¯¸ ë‹¤ë¥¸ íŒ€ì— ì†Œì†ëœ ì„ ìˆ˜ì…ë‹ˆë‹¤.'); return; }
                if (activeTeam.cost + cost > MAX_COST) { alert(`ì˜ˆì‚°ì„ ì´ˆê³¼í•©ë‹ˆë‹¤! (ìµœëŒ€: ${MAX_COST})`); return; }

                activeTeam.members.push({ name, cost });
                activeTeam.cost += cost;

                saveTeams(); 
                renderAll(); 
            });

            allTeamsContainer.addEventListener('click', (event) => {
                const clickedMember = event.target.closest('.team-member');
                if (clickedMember) {
                    const teamBox = event.target.closest('.team-box');
                    const teamId = parseInt(teamBox.dataset.teamId);
                    const team = allTeams.find(t => t.id === teamId);
                    if (!team) return;
                    const memberName = clickedMember.textContent.split(' (')[0];
                    const memberToRemove = team.members.find(m => m.name === memberName);

                    if (memberToRemove) {
                        team.cost -= memberToRemove.cost; 
                        team.members = team.members.filter(m => m.name !== memberName);
                        saveTeams(); 
                        renderAll(); 
                    }
                    return; 
                }

                const clearButton = event.target.closest('.clear-team-button');
                if (clearButton) {
                    const teamBox = event.target.closest('.team-box');
                    const teamId = parseInt(teamBox.dataset.teamId);
                    const teamName = teamBox.dataset.teamName;

                    if (confirm(`${teamName} íŒ€ì„ ë¹„ìš°ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        const teamToClear = allTeams.find(t => t.id === teamId);
                        teamToClear.members = [];
                        teamToClear.cost = 0;
                        if (activeTeamId === teamId) { activeTeamId = 1; }
                        saveTeams(); 
                        renderAll();
                    }
                    return; 
                }

                const removeButton = event.target.closest('.remove-team-button');
                if (removeButton) {
                    const teamBox = event.target.closest('.team-box');
                    const teamId = parseInt(teamBox.dataset.teamId);
                    const teamName = teamBox.dataset.teamName;
                    
                    if (confirm(`'${teamName}' íŒ€ì„ ì™„ì „íˆ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        allTeams = allTeams.filter(t => t.id !== teamId);
                        if (activeTeamId === teamId) {
                            activeTeamId = allTeams.length > 0 ? allTeams[0].id : null;
                        }
                        saveTeams();
                        renderAll();
                    }
                    return; 
                }

                const teamBox = event.target.closest('.team-box');
                if (teamBox) {
                    const clickedTeamId = parseInt(teamBox.dataset.teamId);
                    activeTeamId = clickedTeamId;
                    renderAll(); 
                }
            });

            function setupDropZones() {
                const dropGroups = document.querySelectorAll('.player-button-group');
                dropGroups.forEach(group => {
                    group.addEventListener('dragover', (event) => {
                        event.preventDefault(); group.classList.add('drag-over');
                    });
                    group.addEventListener('dragleave', () => {
                        group.classList.remove('drag-over');
                    });
                    group.addEventListener('drop', (event) => {
                        event.preventDefault(); group.classList.remove('drag-over');
                        const playerName = event.dataTransfer.getData('text/plain');
                        const newCost = parseInt(group.dataset.cost);
                        const newTier = group.dataset.tier;
                        const player = players.find(p => p.name === playerName);

                        if (player && player.cost !== newCost) {
                            const oldCost = player.cost;
                            player.cost = newCost; player.tier = newTier;
                            updateTeamCostForPlayer(playerName, newCost, oldCost);
                            savePlayers(); saveTeams(); renderAll();
                        }
                    });
                });
            }
            
            function renderAll() {
                renderTeamBoxes();
                renderPlayerList(); 
            }

            function renderTeamBoxes() {
                allTeamsContainer.innerHTML = ''; 
                allTeams.forEach(team => {
                    const teamBox = document.createElement('div');
                    teamBox.className = 'team-box';
                    teamBox.dataset.teamId = team.id; teamBox.dataset.teamName = team.name;
                    if (team.id === activeTeamId) { teamBox.classList.add('active'); }
                    
                    const membersHTML = team.members
                        .map(member => 
                            `<span class="team-member" title="í´ë¦­í•˜ì—¬ ${member.name} ì„ ìˆ˜ ì œì™¸">${member.name} (${member.cost || 'N/A'})</span>`
                        ).join(''); 
                    
                    teamBox.innerHTML = `
                        <h3>${team.name} (ì´: ${team.cost} / ${MAX_COST}) [${team.members.length}/${MAX_MEMBERS_PER_TEAM}]</h3> 
                        <div class="team-member-list">${membersHTML}</div>
                        <div class="team-box-buttons"> 
                            <button class="clear-team-button">íŒ€ ë¹„ìš°ê¸°</button>
                            <button class="remove-team-button">íŒ€ ì‚­ì œ</button> 
                        </div>
                    `;
                    allTeamsContainer.appendChild(teamBox);
                });
            }

            function renderPlayerList() {
                const groups = document.querySelectorAll('.player-button-group');
                groups.forEach(group => group.innerHTML = '');

                players.forEach(player => {
                    const button = document.createElement('button');
                    button.className = `player-button tier-${player.tier}`;
                    button.appendChild(document.createTextNode(`${player.name} (${player.cost})`));
                    button.dataset.name = player.name; button.dataset.cost = player.cost;
                    button.draggable = true; 

                    button.addEventListener('dragstart', (event) => {
                        event.target.classList.add('dragging');
                        event.dataTransfer.setData('text/plain', player.name);
                    });
                    button.addEventListener('dragend', (event) => {
                        event.target.classList.remove('dragging');
                    });

                    const deleteBtn = document.createElement('span');
                    deleteBtn.className = 'delete-player-btn'; deleteBtn.textContent = 'Ã—';
                    deleteBtn.title = `${player.name} ì„ ìˆ˜ ëª©ë¡ì—ì„œ ì‚­ì œ`;
                    deleteBtn.addEventListener('click', (event) => {
                        event.stopPropagation(); 
                        const playerName = player.name;
                        const isPlayerTaken = allTeams.some(team => 
                            team.members.some(member => member.name === playerName)
                        );
                        if (isPlayerTaken) {
                            alert('íŒ€ì— ì†Œì†ëœ ì„ ìˆ˜ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\níŒ€ì—ì„œ ë¨¼ì € ì œì™¸í•œ í›„ ì‹œë„í•´ì£¼ì„¸ìš”.');
                            return;
                        }
                        if (confirm(`'${playerName}' ì„ ìˆ˜ë¥¼ ëª©ë¡ì—ì„œ ì˜êµ¬íˆ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                            players = players.filter(p => p.name !== playerName);
                            savePlayers(); renderAll();
                        }
                    });
                    button.appendChild(deleteBtn); 

                    let targetDivId;
                    switch (player.tier) {
                        case 'SSR': targetDivId = 'list-SSR'; break; case 'SR': targetDivId = 'list-SR'; break;
                        case 'S':   targetDivId = 'list-S';   break; case 'A': targetDivId = 'list-A';   break;
                        case 'B':   targetDivId = 'list-B';   break; case 'C': targetDivId = 'list-C';   break;
                        case 'D':   targetDivId = 'list-D';   break; case 'E': targetDivId = 'list-E';   break;
                        default:    targetDivId = null;
                    }
                    if (targetDivId) { document.getElementById(targetDivId).appendChild(button); }
                });
                updatePlayerButtonStates();
            }

            function updatePlayerButtonStates() {
                const takenPlayers = new Set();
                allTeams.forEach(team => { team.members.forEach(member => takenPlayers.add(member.name)); });
                const activeTeam = allTeams.find(team => team.id === activeTeamId);

                document.querySelectorAll('.player-button').forEach(button => {
                    const name = button.dataset.name; const cost = parseInt(button.dataset.cost);
                    const activeTeamIsFull = activeTeam && activeTeam.members.length >= MAX_MEMBERS_PER_TEAM;

                    if (takenPlayers.has(name)) {
                        button.classList.add('selected'); button.classList.remove('disabled'); button.disabled = true;
                    } else if (!activeTeam || activeTeamIsFull) { 
                        button.classList.add('disabled'); button.classList.remove('selected'); button.disabled = true;
                    } else if (activeTeam.cost + cost > MAX_COST) {
                        button.classList.add('disabled'); button.classList.remove('selected'); button.disabled = true;
                    } else {
                        button.classList.remove('selected', 'disabled'); button.disabled = false;
                    }
                });
            }

            setupDropZones(); 
            renderAll(); 
        });
    </script> 
</body>
</html>
